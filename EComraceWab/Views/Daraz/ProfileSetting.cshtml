@model EComraceWab.Entites.User

@{
    Layout = "~/Views/Shared/_Layout1.cshtml";
}

<style>
    .container {
        max-width: 1260px;
        margin: 20px auto;
        padding: 1px;
    }

    h1 {
        font-size: 20px;
        text-align: center;
        margin: 20px 0 20px;
    }

        h1 small {
            display: block;
            font-size: 15px;
            padding-top: 8px;
            color: gray;
        }

    .avatar-upload {
        position: relative;
        max-width: 205px;
        margin: 50px auto;
    }

        .avatar-upload .avatar-edit {
            position: absolute;
            right: 12px;
            z-index: 1;
            top: 10px;
        }

            .avatar-upload .avatar-edit input {
                display: none;
            }

                .avatar-upload .avatar-edit input + label {
                    display: inline-block;
                    width: 34px;
                    height: 34px;
                    margin-bottom: 0;
                    border-radius: 100%;
                    background: #FFFFFF;
                    border: 1px solid transparent;
                    box-shadow: 0px 2px 4px 0px rgba(0, 0, 0, 0.12);
                    cursor: pointer;
                    font-weight: normal;
                    transition: all 0.2s ease-in-out;
                }

                    .avatar-upload .avatar-edit input + label:hover {
                        background: #f1f1f1;
                        border-color: #d6d6d6;
                    }

                    .avatar-upload .avatar-edit input + label:after {
                        content: "";
                        font-family: 'FontAwesome';
                        color: #757575;
                        position: absolute;
                        top: 10px;
                        left: 0;
                        right: 0;
                        text-align: center;
                        margin: auto;
                    }

        .avatar-upload .avatar-preview {
            width: 192px;
            height: 192px;
            position: relative;
            border-radius: 100%;
            border: 6px solid #F8F8F8;
            box-shadow: 0px 2px 4px 0px rgba(0, 0, 0, 0.1);
        }

            .avatar-upload .avatar-preview > div {
                width: 100%;
                height: 100%;
                border-radius: 100%;
                background-size: cover;
                background-repeat: no-repeat;
                background-position: center;
            }
</style>

<section class="padding-y bg-light">
    <div class="container">


        <div class="row">
            <main class="col-xl-8 col-lg-8" id="model">

              
                <!-- ============== COMPONENT CHECKOUT =============== -->
                <article class="card">
                    @* <div class="content-body">
                    <div>
                    <img  class="css-border" src="~/images/default.png.png" id="img">
                    <i class="bi bi-camera"> </i>
                    <input type="file"  id="Image" name="image" onchange="UplodImagee(this)"  />
                    </div>*@
                    <div class="container">
                        <div class="avatar-upload">
                            <div class="avatar-edit">
                                <input type='file' id="imageUpload" accept=".png, .jpg, .jpeg" />
                                <label for="imageUpload" class="bi bi-camera-fill"></label>
                            </div>
                            <div class="avatar-preview">
                                <div id="imagePreview" style="background-image: url('https://static.thenounproject.com/png/5034901-200.png');">
                                </div>
                            </div>
                        </div>
                    </div>
                    <h5 class="card-title">  </h5>
                    <div class="row">
                        <div class="col-6 mb-3">
                            <label class="form-label">FirstName</label>
                            <input type="text" class="form-control" placeholder="Type here FirstName" id="FirstName">
                            <input hidden id="Id">
                            <input hidden id="StoreId">
                        </div> <!-- col end.// -->

                        <div class="col-6">
                            <label class="form-label">LastName</label>
                            <input type="text" class="form-control" placeholder="Type here LastName" id="LastName">
                        </div>
                        <div class="input-group mb-3" id="EmailForgot">
                            <span class="input-group-text"><i class="bi bi-envelope-fill"></i></span>
                            <input class="form-control" id="Email" name="Email" placeholder="emil address" value="">
                        </div>

                        <div class="input-group mb-3" >
                            <span class="input-group-text"><i class="bi bi-lock"></i></span>
                            <input type="password" class="form-control" id="Password" name="Password" placeholder="Password" value="">
                            <span class="input-group-text"><i class="bi bi-eye-slash" id="togglePasswordd"></i></span>
                        </div>

                        <div class="input-group mb-3" >
                            <span class="input-group-text"><i class="bi bi-lock"></i></span>
                            <input type="password" class="form-control" id="ConfirmPassword" name="Password" placeholder="Confirm Password" value="">
                            <span class="input-group-text"><i class="bi bi-eye-slash" id="confirmPasswordd"></i></span>
                        </div>
                        <p></p>
                        <!-- col end.// -->
                    </div> <!-- row.// -->


                    <hr class="my-4">

                    <!-- row end.// -->

                    <div class="row" id="Store">
                        <div class="col-6 mb-3">
                            <label class="form-label">Store name</label>
                            <input type="text" class="form-control" placeholder="Type here Store name" id="Name">
                        </div> <!-- col end.// -->

                        <div class="col-6">
                            <label class="form-label">Phone</label>
                            <input type="text" class="form-control" placeholder="Type here Phone " id="Phone">
                        </div>
                        <div class="col-sm-8 mb-3" id="Addressdiv">
                            <label for="" class="form-label">Address</label>
                            <input type="text" class="form-control" placeholder="Type here Address" id="Address">
                        </div>
                        <div class="col-sm-4 mb-3" id="Citydiv">
                            <label for="" class="form-label">City*</label>
                            <input type="text" class="form-control" placeholder="Type here City" id="City">
                        </div>

                        <div class="mb-4">
                            <label for="" class="form-label">Shipping Info</label>
                            <textarea class="form-control" id="ShippingInfo"></textarea>
                        </div> <!-- col end.// -->

                    </div>
                    <div class="float-end">
                        <button id="btnCreate" class="btn btn-success " >Reset</button>
                    </div>
        </article> <!-- card end.// -->
        <!-- ============== COMPONENT CHECKOUT .// =============== -->
        </main> <!-- col.// -->
        <!-- ============== COMPONENT SUMMARY .// =============== -->
       </div> <!-- card-body end.// -->
    </div> <!-- row.// -->

    <br><br>

    </div> <!-- container .//  -->
</section>

<script type="text/javascript">
    $(document).ready(function () {
        debugger

          $("#Store").hide();
        Profiledata();
    });
    function Profiledata() {
        debugger


        var token = sessionStorage.getItem('Token');
        $.ajax({
            headers: {
                Authorization: `Bearer ` + token
            },
            url: '/Daraz/ProfileSetting',
            success: function (response) {

                $('#Id').val(response.User.Id);
                $('#FirstName').val(response.User.FirstName);
                $('#LastName').val(response.User.LastName);
                $('#Email').val(response.User.Email);
              $('#Password').val(response.User.Password);
                $('#ConfirmPassword').val(response.User.ConfirmPassword);
                   $('#imagePreview').css('background-image', 'url(' + response.User.Image + ')');
                if (response.store != null){
                    $("#Store").show();
                    $('#StoreId').val(response.store.Id);
                    $('#Name').val(response.store.Name);
                    $('#Phone').val(response.store.Number);
                    $('#Address').val(response.store.Address);
                    $('#City').val(response.store.City);
                    $('#ShippingInfo').val(response.store.ShippingInfo);
                }
                debugger
            }
        });
     }
    function UplodImagee(input) {
        //   $("#image").hide();
        debugger
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            reader.onload = function (element) {
                $("#img").attr("src", element.target.result).width(100).height(100);
                console.log(element);

            };
            reader.readAsDataURL(input.files[0]);
            // $("#Image").show();
        };
    };
    const togglePasswordd = document.querySelector("#togglePasswordd");
    const passwordd = document.querySelector("#Password");

    togglePasswordd.addEventListener("click", function () {

        // toggle the type attribute
        const type = passwordd.getAttribute("type") === "password" ? "text" : "password";
        passwordd.setAttribute("type", type);

        // toggle the eye icon
        this.classList.toggle('bi-eye');
    });
    const ConfirmPasswordd = document.querySelector("#confirmPasswordd");
    const confirmPasswordd = document.querySelector("#ConfirmPassword");

    ConfirmPasswordd.addEventListener("click", function () {

        // toggle the type attribute
        const type = confirmPasswordd.getAttribute("type") === "password" ? "text" : "password";
        confirmPasswordd.setAttribute("type", type);

        // toggle the eye icon
        this.classList.toggle('bi-eye');
    });
    $("#btnCreate").click(function () {
       
            var first_name = $('#FirstName').val();
            var last_name = $('#LastName').val();
            var email = $('#Email').val();
            var password = $('#Password').val();
            var confirmPassword = $('#ConfirmPassword').val();

            $(".error").remove();

            if (first_name.length < 1) {
                $('#FirstName').after('<span class="error text-danger">This FirstName is required</span>');
                return;
            }
            if (last_name.length < 1) {
                $('#LastName').after('<span class="error text-danger ">This LastName is required</span>');
                return;
            }
            if (email.length < 1) {
                $('#Email').after('<span class="error text-danger">This Email is required</span>');
                return;
            }

            if (password.length < 8) {
                $('#Password').after('<span class="error text-danger">Password must be at least 8 characters long</span>');
                return;
            } if (password != confirmPassword) {
                $('#ConfirmPassword').after('<span class="error text-danger">password did not match</span>');
                return;
            }
            var file = $("#imageUpload").get(0).files;
            var data = new FormData;
            data.append("Id", $("#Id").val());
            data.append("StoreId", $("#StoreId").val());
            data.append("FirstName", $("#FirstName").val());
            data.append("LastName", $("#LastName").val());
            data.append("Email", $("#Email").val());
            data.append("Password", $("#Password").val());
            data.append("ConfirmPassword", $("#ConfirmPassword").val());
            data.append("Name", $("#Name").val());
            data.append("Address", $("#Address").val());
            data.append("City", $("#City").val());
            data.append("Number", $("#Phone").val());
            data.append("ShippingInfo", $("#ShippingInfo").val());
            data.append("Image", file[0])
            
            debugger
            console.log(data);
  var token = sessionStorage.getItem('Token');
        $.ajax({
            headers: {
                Authorization: `Bearer ` + token
            },
            type: 'POST',
            async: true,
            data: data,
            url: "/Daraz/UpdateUser",
            processData: false,
            contentType: false,
            success: function (data) {
                debugger
                console.log(data);
                if(data.Address != null){
                    window.location.href = '/Home/SallerHomePage?Id=' + data.Id;
                    
                }else{
                window.location.href = '/Daraz/Home';}

            },

            error: function () {
                alert("Something went wrong");
                ("Email is already taken ");
            },
        });
    });
    function readURL(input) {
        debugger
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            reader.onload = function (e) {
                $('#imagePreview').css('background-image', 'url(' + e.target.result + ')');
                $('#imagePreview').hide();
                $('#imagePreview').fadeIn(650);
            }
            reader.readAsDataURL(input.files[0]);
        }
    }
    $("#imageUpload").change(function () {
        readURL(this);
    });
</script>
